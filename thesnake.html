<!DOCTYPE html>
<head>
  <title>Учеба</title>
</head>

<body id = "body">

<div class="window">
	<div class="allSnake">
		<div class="snakeHade"></div>
		<div class="snakeTail"></div>
	</div>
	<div class="eat"></div>
	<div class="counter">"0"</div>
</div>


<div class="table"></div>


<div class="allButtons">
	<button class="button-clear" onclick="clearTime()">Стоп</button>

	<button class="button" onclick="startGame()">Старт</button>

	<button class="button-up" onclick="changeDirectionUp()">Вверх</button>
	<button class="button-left" onclick="changeDirectionLeft()">Лево</button>
	<button class="button-right" onclick="changeDirectionRight()">Право</button>
	<button class="button-down" onclick="changeDirectionDown()">Вниз</button>
</div>



<style>

.table {
	position: absolute;
	top: 0px;
	left: 0px;
	height: 600px;
	width: 1000px;
}

.string {
	display: flex;
	flex-direction: row;
}

.item {
	height: 40px;
	width: 40px;
}

.itemActive {
	background-color: red; 
	height: 40px; 
	width: 40px;
}

.window {
	position: absolute;
	top: -1px;
	left:-1px;
	height: 600px;
	width: 1000px;
	border: 1px solid gray;
}

.counter {
	position: absolute;
	top: 620px;
	left: 100px;
}

.snakeHade {
	position: absolute;
	top: 320px;
	left: 480px;
	height: 40px;
	width: 40px;
	background-color: red;
}

.snakeBody {
	position: absolute;
	height: 40px;
	width: 40px;
	top: 360px;
	left: 480px;
	background-color: yellow;
}

.snakeTail {
	position: absolute;
	height: 40px;
	width: 40px;
	top: 360px;
	left: 480px;
	background-color: orange;
	z-index: 30;
}

.button {
	position: absolute;
	top: 650px;
	left: 500px;
}

.button-up {
	position: absolute;
	top: 700px;
	left: 500px;
}

.button-left {
	position: absolute;
	top: 730px;
	left: 450px;
}

.button-right {
	position: absolute;
	top: 730px;
	left: 550px;
}

.button-down {
	position: absolute;
	top: 730px;
	left: 500px;
}

.button-clear {
	position: absolute;
	top: 770px;
	left: 500px;
}

.eat {
	position: absolute;
	z-index: 30;
	top: 0px;
	left: 0px;
	height: 40px;
	width: 40px;
	background-color: green;
}

</style>

<script>

var tableElem = document.querySelector('.table');
var tablePeremOne = 0;
var tablePeremTwo = 0;
var tablePeremThree = 0;
var tableSquareVertSize = 15;
var tableSquareHorizonSize = 25;
while(tablePeremOne < tableSquareVertSize){
	tableElem.innerHTML += '<div class="string"></div>';
	tablePeremOne++;
};
var tableString = document.querySelectorAll('.string');
while(tablePeremThree < tableSquareVertSize) {
	tablePeremTwo = 0;
	while(tablePeremTwo < tableSquareHorizonSize){
		tableString[tablePeremThree].innerHTML += '<div class="item"></div>'
		tablePeremTwo++;
	};
	tablePeremThree++;
};

const isPlaceForEat = true;

var item = document.querySelectorAll('.item');

var windows = document.querySelector('.window');
var eat = document.querySelector('.eat');
var elem = document.querySelector('.snakeHade');
var elemTail = document.querySelector('.snakeTail');

var counter = 0;
var counterMeter = document.querySelector('.counter');
counterMeter.innerHTML = `${counter}`;

var timer;

var sizeSquare = 40;
var allSqyare = 375;

var state = {
	snakeDirection: "x",
	x: 480,
	y: 320,
	speedSnakeGame: 200,
	snakeSpeed: -40,
	allSnakeMovies: ["up"],
	snakeDirectionMove: "up",
	r: 1,
	snakeTailX: 480,
	snakeTailY: 360,
	directionSnakeBody: ["", ""],
}


function startGame() {
	console.log("Start!");
	timer = setInterval(moveSnake, state.speedSnakeGame);
};

function moveSnake() {
	var t = 0;
	var dSB;
	while(t < 375){
		if(state.x == item[t].getBoundingClientRect().x && state.y == item[t].getBoundingClientRect().y) {
			item[t].classList = "itemActive";			
			state.directionSnakeBody.push(item[t].getBoundingClientRect().x);
			state.directionSnakeBody.push(item[t].getBoundingClientRect().y);
		};
		t++;
	};
	state.allSnakeMovies.push(state.snakeDirectionMove);
	switch(state.snakeDirection) {
        case "x":
            state.y += state.snakeSpeed;
            if((state.y > windows.getBoundingClientRect().height - 42) || (state.y < 0) || (state.x > windows.getBoundingClientRect().width - 42) || (state.x < 0)){
 				console.log("условие работает");
 				clearTime()
 				break;
  			};
  			var peremX = 0;
  			while(peremX <= state.directionSnakeBody.length) {
  				if(state.x == state.directionSnakeBody[peremX] && state.y == state.directionSnakeBody[peremX + 1]){
  					clearTime()
  					console.log("Игра окончена");
  				};
  			peremX += 2;
  			};
            elem.style.top = state.y + "px";
            moveBodySnake();
            break;
        case "y":
            state.x += state.snakeSpeed;
            if((state.y > windows.getBoundingClientRect().height - 42) || (state.y < 0) || (state.x > windows.getBoundingClientRect().width - 42) || (state.x < 0)){
 				console.log("условие работает");
 				clearTime()
 				break;
  			};
  			var peremX = 0;
  			while(peremX <= state.directionSnakeBody.length) {
  				if(state.x == state.directionSnakeBody[peremX] && state.y == state.directionSnakeBody[peremX + 1]){
  					clearTime()
  					console.log("Игра окончена");
  				};
  			peremX += 2;
  			};
            elem.style.left = state.x + "px";
            moveBodySnake();
            break;
        default: 
			break;
    };
    if (elem.style.left == eat.style.left && elem.style.top == eat.style.top) {
 		counter++;
  		counterMeter.innerHTML = `${counter}`;
  		eat.style.top = getRandomIntInclusive(0, 14) * sizeSquare + "px";
		eat.style.left = getRandomIntInclusive(0, 24) * sizeSquare + "px";
		state.speedSnakeGame = state.speedSnakeGame * 0.97;
		state.allSnakeMovies.splice(state.r - 1, 0, "increase");
	};	
};

function changeDirectionUp() {
	state.snakeDirection = "x";
	state.snakeSpeed = -sizeSquare;
	state.snakeDirectionMove = "up";
};
function changeDirectionLeft() {
	state.snakeDirection = "y";
	state.snakeSpeed = -sizeSquare;
	state.snakeDirectionMove = "left";
};
function changeDirectionRight() {
	state.snakeDirection = "y";
	state.snakeSpeed = sizeSquare;
	state.snakeDirectionMove = "right";
};
function changeDirectionDown() {
	state.snakeDirection = "x";
	state.snakeSpeed = sizeSquare;
	state.snakeDirectionMove = "down";
};

function getRandomIntInclusive(min, max) {
  min = Math.ceil(min);
  max = Math.floor(max);
  return Math.floor(Math.random() * (max - min + 1)) + min;
}

function moving(){
	eat.style.top = getRandomIntInclusive(0, 14) * sizeSquare + "px";
	eat.style.left = getRandomIntInclusive(0, 24) * sizeSquare + "px";
	state.speedSnakeGame = state.speedSnakeGame * 0.97;
};

function clearTime() {
    var z = clearInterval(timer);
};

function moveBodySnake() {
	switch(state.allSnakeMovies[state.r - 1]) {
        case 'up':
        	state.snakeTailY -= sizeSquare;
        	elemTail.style.top = state.snakeTailY + "px";
        	var i = 0;
    		while(i < allSqyare){
				if(state.snakeTailX == item[i].getBoundingClientRect().x && state.snakeTailY == item[i].getBoundingClientRect().y) {
					item[i].classList = "item";
					state.directionSnakeBody.splice(0, 2);
				};
				i++;
			};
            break;
        case 'left':
        	state.snakeTailX -= sizeSquare;
        	elemTail.style.left = state.snakeTailX + "px";
        	var i = 0;
    		while(i < allSqyare){
				if(state.snakeTailX == item[i].getBoundingClientRect().x && state.snakeTailY == item[i].getBoundingClientRect().y) {
					item[i].classList = "item";
					state.directionSnakeBody.splice(0, 2);
				};
				i++;
			};
            break;
        case 'right':
        	state.snakeTailX += sizeSquare;
        	elemTail.style.left = state.snakeTailX + "px";
        	var i = 0;
    		while(i < allSqyare){
				if(state.snakeTailX == item[i].getBoundingClientRect().x && state.snakeTailY == item[i].getBoundingClientRect().y) {
					item[i].classList = "item";
					state.directionSnakeBody.splice(0, 2);
				};
				i++;
			};
            break;
        case 'down':
        	state.snakeTailY += sizeSquare;
        	elemTail.style.top = state.snakeTailY + "px";
        	var i = 0;
    		while(i < allSqyare){
				if(state.snakeTailX == item[i].getBoundingClientRect().x && state.snakeTailY == item[i].getBoundingClientRect().y) {
					item[i].classList = "item";
					state.directionSnakeBody.splice(0, 2);
				};
				i++;
			};
            break;
        default: 	
			break;
    };
    state.r++;
};

document.addEventListener('keydown', function(event){
    if (event.code == "ArrowLeft") {
        changeDirectionLeft();
    }
});

document.addEventListener('keydown', function(event){
    if (event.code == "ArrowUp") {
        changeDirectionUp();
    }
});

document.addEventListener('keydown', function(event){
    if (event.code == "ArrowRight") {
        changeDirectionRight();
    }
});

document.addEventListener('keydown', function(event){
    if (event.code == "ArrowDown") {
        changeDirectionDown();
    }
});


moving();

</script>
</body>